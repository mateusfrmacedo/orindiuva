<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="description" content="Acompanhe Orindi√∫va ao vivo.">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<meta property="og:type" content="website">
<meta property="og:title" content="Orindi√∫va Ao Vivo">
<meta property="og:description" content="Clima em tempo real, not√≠cias e c√¢mera ao vivo.">
<meta property="og:image" content=""> 

<meta name="theme-color" content="#f2f2f7" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#141414" media="(prefers-color-scheme: dark)">

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå•Ô∏è</text></svg>">

<title>Orindi√∫va Ao Vivo</title>

<style>
:root {
  --sf: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --bg-light: #f2f2f7; --text-light: #1c1c1e; --glass-light: #ffffff;
  --border-light: rgba(0, 0, 0, 0.05); --shadow-light: 0 4px 12px rgba(0,0,0,0.06);
  --detail-bg-light: rgba(0,0,0,0.04);
  --bg-dark: #141414; --text-dark: #f2f2f7; --glass-dark: #1c1c1e;
  --border-dark: rgba(255, 255, 255, 0.1); --shadow-dark: 0 4px 12px rgba(0,0,0,0.5);
  --detail-bg-dark: rgba(255,255,255,0.06);
}

* { box-sizing: border-box; }

html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: var(--sf);
  background-color: var(--bg-light);
  color: var(--text-light);
  transition: background-color 0.3s ease, color 0.3s ease;
  overflow-x: hidden;
}

body.dark { background-color: var(--bg-dark); color: var(--text-dark); }

.site { max-width: 1000px; margin: 0 auto; padding: 40px 24px; min-height: 100vh; display: flex; flex-direction: column; }
.header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
.title-box h1 { margin: 0; font-size: clamp(32px, 6vw, 56px); font-weight: 800; letter-spacing: -2px; line-height: 1.1; }
.status-badge { display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 700; color: #ff3b30; background: rgba(255, 59, 48, 0.1); padding: 4px 10px; border-radius: 20px; margin-top: 8px; text-transform: uppercase; }
.pulse { width: 8px; height: 8px; background: currentColor; border-radius: 50%; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { opacity: 1; } 50% { opacity: .4; } 100% { opacity: 1; } }

.theme-toggle { width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--border-light); cursor: pointer; background: var(--glass-light); box-shadow: var(--shadow-light); display: grid; place-items: center; padding: 0; font-size: 22px; line-height: 1; transition: all 0.3s; }
body.dark .theme-toggle { background: var(--glass-dark); border: 1px solid var(--border-dark); box-shadow: var(--shadow-dark); }
.theme-toggle:active { transform: scale(0.92); } .theme-toggle span { user-select: none; }

.video-container { position: relative; width: 100%; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.12); aspect-ratio: 16/9; background: #000; margin-bottom: 24px; }
.video-container iframe { width: 100%; height: 100%; border: 0; }

.dashboard-card { background: var(--glass-light); border: 1px solid var(--border-light); box-shadow: var(--shadow-light); border-radius: 24px; padding: 24px; margin-bottom: 24px; display: flex; flex-direction: column; gap: 20px; }
body.dark .dashboard-card { background: var(--glass-dark); border: 1px solid var(--border-dark); box-shadow: var(--shadow-dark); }

.dash-top { display: flex; justify-content: space-between; align-items: flex-start; }
.current-weather h2 { margin: 0; font-size: 42px; font-weight: 700; letter-spacing: -1px; }
.current-weather p { margin: 4px 0 0; font-size: 18px; font-weight: 500; opacity: 0.8; }
.clock-area { text-align: right; }
.clock-time { font-size: 28px; font-weight: 600; font-variant-numeric: tabular-nums; }
.clock-date { font-size: 14px; opacity: 0.6; margin-top: 4px; text-transform: capitalize; }

/* --- LETREIRO DIGITAL --- */
.ticker-wrap { width: 100%; overflow: hidden; background-color: #000; padding: 12px 0; border-radius: 8px; border: 2px solid #333; white-space: nowrap; box-sizing: border-box; margin-top: -10px; margin-bottom: 5px; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.9); }
.ticker { display: inline-block; white-space: nowrap; padding-left: 100%; }
.ticker-item { display: inline-block; padding: 0 30px; font-family: 'VT323', monospace; font-size: 26px; letter-spacing: 1.5px; color: #00ff41; text-shadow: 0 0 8px rgba(0, 255, 65, 0.7); text-transform: uppercase; }
@keyframes ticker-scroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

.dash-details { display: flex; gap: 12px; }
.detail-pill { flex: 1; background: var(--detail-bg-light); padding: 12px; border-radius: 12px; text-align: center; font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 4px; }
body.dark .detail-pill { background: var(--detail-bg-dark); }
.detail-label { font-size: 11px; opacity: 0.5; font-weight: 500; text-transform: uppercase; }
.detail-value { display: flex; align-items: center; gap: 6px; }

.skeleton { background: linear-gradient(90deg, var(--detail-bg-light) 25%, rgba(0,0,0,0.1) 50%, var(--detail-bg-light) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; color: transparent !important; border-radius: 4px; display: inline-block; min-width: 40px; user-select: none; }
body.dark .skeleton { background: linear-gradient(90deg, var(--detail-bg-dark) 25%, rgba(255,255,255,0.1) 50%, var(--detail-bg-dark) 75%); }
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

.forecast-row { display: flex; justify-content: space-between; border-top: 1px solid var(--border-light); padding-top: 20px; }
body.dark .forecast-row { border-top: 1px solid var(--border-dark); }
.forecast-item { text-align: center; flex: 1; display: flex; flex-direction: column; align-items: center; }
.f-day { font-size: 13px; font-weight: 600; opacity: 0.7; margin-bottom: 2px; text-transform: uppercase; }
.f-icon { font-size: 26px; line-height: 1.2; margin-bottom: 2px; } 
.f-temp { font-size: 16px; font-weight: 700; }
.f-min { font-size: 12px; opacity: 0.5; margin-left: 4px; }

.site-footer { margin-top: auto; padding-top: 60px; text-align: center; padding-bottom: 20px; }
.donation-card { display: inline-flex; flex-direction: column; align-items: center; padding: 24px 40px; margin: 0 auto; background: var(--glass-light); border: 1px solid var(--border-light); box-shadow: var(--shadow-light); border-radius: 20px; }
body.dark .donation-card { background: var(--glass-dark); border: 1px solid var(--border-dark); box-shadow: var(--shadow-dark); }
.donation-title { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
.donation-desc { font-size: 14px; opacity: 0.7; margin-bottom: 18px; line-height: 1.4; }
.btn-donate { position: relative; display: flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 12px; border: none; background: linear-gradient(135deg, #32bcad 0%, #229a8e 100%); color: #fff; font-size: 15px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(50, 188, 173, 0.3); }
.btn-donate:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(50, 188, 173, 0.4); }
.btn-donate:active { transform: translateY(0); }
.copy-feedback { position: absolute; top: -35px; background: #333; color: #fff; padding: 4px 10px; border-radius: 6px; font-size: 12px; opacity: 0; pointer-events: none; transform: translateY(10px); transition: all 0.2s; }
.copy-feedback.show { opacity: 1; transform: translateY(0); }
.footer-credit { display: block; margin-top: 25px; font-size: 11px; opacity: 0.4; color: inherit; text-decoration: none; transition: opacity 0.2s; }
.footer-credit:hover { opacity: 1; text-decoration: underline; }

</style>
</head>

<body>

<div class="site">
  <header class="header">
    <div class="title-box">
      <h1>Orindi√∫va</h1>
      <div class="status-badge"><div class="pulse"></div> Ao Vivo</div>
    </div>
    <button id="themeToggle" class="theme-toggle" aria-label="Alternar tema">
      <span id="moonIcon">üåô</span><span id="sunIcon" style="display:none">‚òÄÔ∏è</span>
    </button>
  </header>

  <section class="video-container">
    <iframe src="https://www.youtube.com/embed/ZckoMMSCV5c?autoplay=1&mute=1&controls=1&rel=0&modestbranding=1" title="C√¢mera" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </section>

  <div class="dashboard-card">
    <div class="dash-top">
      <div class="current-weather">
        <h2 id="currTemp" class="skeleton">--¬∞C</h2>
        <p id="currCond" class="skeleton">Carregando...</p>
      </div>
      <div class="clock-area">
        <div class="clock-time" id="clockTime">--:--:--</div>
        <div class="clock-date" id="clockDate">--</div>
      </div>
    </div>

    <div class="ticker-wrap">
      <div class="ticker" id="newsTicker">
        <div class="ticker-item">INICIANDO SISTEMA...</div>
      </div>
    </div>

    <div class="dash-details">
      <div class="detail-pill"><span class="detail-label">üí® Vento</span><span id="windSpeed" class="skeleton">-- km/h</span></div>
      <div class="detail-pill"><span class="detail-label">üî∫ M√°x</span><span id="maxTemp" class="skeleton">--¬∞C</span></div>
      <div class="detail-pill"><span class="detail-label">üîª M√≠n</span><span id="minTemp" class="skeleton">--¬∞C</span></div>
    </div>
    <div class="dash-details">
      <div class="detail-pill"><span class="detail-label">üåÖ Nascer Sol</span><span id="sunriseTime" class="detail-value skeleton">--:--</span></div>
      <div class="detail-pill"><span class="detail-label">üåá P√¥r do Sol</span><span id="sunsetTime" class="detail-value skeleton">--:--</span></div>
      <div class="detail-pill"><span class="detail-label" id="moonLabel">üåô Lua</span><span id="moonPhase" class="detail-value skeleton">--</span></div>
    </div>
    <div class="forecast-row" id="forecastBox">
      <div class="forecast-item skeleton">...</div>
      <div class="forecast-item skeleton">...</div>
      <div class="forecast-item skeleton">...</div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="donation-card">
      <div class="donation-title">Gostou?</div>
      <div class="donation-desc">Ajude a manter a c√¢mera online. Qualquer valor √© bem-vindo!</div>
      <button class="btn-donate" id="pixButton">
        <div class="copy-feedback" id="pixFeedback">Copiado!</div>
        <span>üíµ</span> Copiar Chave Pix
      </button>
    </div>
    <a href="http://mateusfrmacedo.github.io" target="_blank" class="footer-credit">create by Mateus</a>
  </footer>
</div>

<script>
const CHAVE_PIX = "mateus.freitas@me.com";

// --- BANCOS DE DADOS (DEFINIDOS ANTES DE TUDO) ---

const funnyPhrases = [
  "ACORDEI CEDO PARA ME ATRASAR COM CALMA",
  "O FINAL DE SEMANA DEVERIA LEVAR MULTA POR EXCESSO DE VELOCIDADE",
  "SE A VIDA TE DER LIMOES FACA UMA CAIPIRINHA",
  "ESTADO CIVIL COM FOME",
  "SORRIA ISSO CONFUNDE AS PESSOAS",
  "NAO SOU PREGUICOSO ESTOU EM MODO DE ECONOMIA DE ENERGIA",
  "HOJE ESTOU MAIS PERDIDO QUE CEGO EM TIROTEIO",
  "MINHA DIETA COMECA SEMPRE AMANHA",
  "DINHEIRO NAO TRAZ FELICIDADE MAS COMPRA PIZZA",
  "O MUNDO DA VOLTAS E EU FICO TONTO",
  "PRECISO DE 6 MESES DE FERIAS 2 VEZES POR ANO",
  "TO NEM AI PRO CLIMA MAIS",
  "CORRER ATRAS DE BALAO E PRA QUEM TEM FOLEGO",
  "QUEM CEDO MADRUGA FICA COM SONO O DIA TODO",
  "ACORDAR CEDO E UM CRIME E EU SOU A VITIMA",
  "MEU BOM HUMOR FOI DEMITIDO POR JUSTA CAUSA",
  "HOJE EU SO FUNCIONO A BASE DE ODIO E CAFEINA",
  "ME ESFORCO PARA SER UMA PESSOA MELHOR MAS O MUNDO NAO AJUDA",
  "A REALIDADE CHEGA SEMPRE ATRASADA MAS CHEGA PRA ESTRAGAR TUDO",
  "SE A SEMANA TIVESSE UM ROSTO EU DARIA UM TAPA",
  "MINHA PACIENCIA JA FOI PROCURADA NO GOOGLE E CONTINUA DESAPARECIDA",
  "MEUS PLANOS DO DIA FORAM CANCELADOS POR FALTA DE VONTADE",
  "HOJE ESTOU SENDO PATROCINADO PELO DESANIMO",
  "VOU FAZER CHURRASCO HJ",
  "TO COM SONO",
  "ESTOU FUNCIONANDO NO MODO STANLEY APENAS ESPERANDO A HORA DE IR EMBORA",
  "PARABENS VOCE SOBREVIVEU A NOITE AGORA FALTA SOBREVIVER AO RESTO DA SUA VIDA",
  "A ATMOSFERA HOJE ESTA ESTAVEL DIFERENTE DE VOCE",
  "O CLIMA ESTA MENOS TOXICO QUE SUA ROTINA MAS NAO POR MUITO",
  "TEMPERATURA EM ALTA SUA UTILIDADE EM BAIXA",
  "O SOL ESTA FORTE SUA VONTADE DE EXISTIR NAO",
  "VENTOS FRACOS HOJE IGUAL A SUA DISCIPLINA",
  "CHANCE DE CHUVA BAIXA CHANCE DE VOCE SE ORGANIZAR ZERO",
  "HA UMA FRENTE FRIA CHEGANDO MAIS FRIA SO A SUA MOTIVACAO",
  "CEU PARCIALMENTE NUBLADO SEU FUTURO TAMBEM",
  "SE A PRESSAO ATMOSFERICA SUBIR MAIS UM POUCO AINDA VAI SER MENOR QUE SUA PRESSAO PARA PRODUZIR ALGO",
  "NIVEL DE RADIACAO UV ELEVADO OTIMO PARA JUSTIFICAR FICAR DENTRO DE CASA SEM FAZER NADA",
  "O DIA PROMETE SER LIMPO INFELIZMENTE SEUS RESULTADOS NAO",
  "UMIDADE ALTA PROVAVELMENTE A MESMA QUE SUA CAPACIDADE DE DESAPONTAR",
  "CONDICOES IDEAIS PARA CAMINHAR MAS VOCE VAI CONTINUAR SENTADO",
  "ESTATISTICAS CLIMATICAS ATUALIZADAS SUAS CONTINUAM DECEPCIONANTES",
  "HOJE O DIA PROMETE VOCE INFELIZMENTE NAO",
  "SORRIR PRA QUE SE O CAOS JA FAZ ISSO POR MIM"
];

const weatherPhrases = {
  storm: [
    "TEMPESTADE CHEGANDO: A NATUREZA TEVE UM SURTO",
    "RAIOS POR PERTO: HOJE O CEU ESTA TIRANDO FAISCA DE QUALQUER COISA",
    "VENTANIA FORTE: SE VOAR LEMBRE DE CAIR COM ESTILO",
    "TROVOES: O CEU ESTA BATENDO PORTA DE MAL HUMOR",
    "ALERTA: QUALQUER GUARDA CHUVA VIROU PARA RAIOS AMBULANTE"
  ],
  rain: [
    "CHUVA CHEGANDO: O CEU VIU A CONTA DE LUZ E DESABOU",
    "PISTA MOLHADA: FREOU TARDE VIROU CARRO NAUTICO",
    "GAROA: A CHUVA QUE NAO TEM CORAGEM DE SER CHUVA",
    "CHUVARADA: DEUS LIGOU O MODO LAVA RAPIDO",
    "PRECIPITACAO: A UNICA COISA QUE CAI MAIS QUE PROMESSA DE ANO NOVO"
  ],
  heat: [
    "CALOR INTENSO: SUA SOMBRA TA PEDINDO AGUA",
    "SOL FORTE: O ASFALTO ESTA FRITANDO ATE PENSAMENTO",
    "AR SECO: PISCAR VIROU EXERCICIO DE RISCO",
    "CALORAO: QUALQUER UM VIROU CHURRASCO EM POTENCIAL",
    "TEMPERATURA ALTA: HOJE O AR CONDICIONADO E SOBERANO"
  ],
  cold: [
    "FRIO NA REGIAO: QUALQUER VENTO E UMA AGRESSAO PESSOAL",
    "BAIXA TEMPERATURA: DEDOS EM MODO ICEBERG",
    "SENSACAO TERMICA: CONGELANDO ATE A VONTADE DE VIVER",
    "GELO NO AR: O CLIMA ESTA FAZENDO COSPLAY DE SIBERIA",
    "FRIO INTENSO: ATE PINGUIM PEDIU UM COBERTOR"
  ],
  clear: [
    "CEU LIMPO: O CLIMA ESTA EM MODO TURBO PREMIUM",
    "SOL SUAVE: HOJE O CEU TA NO SEU MELHOR COMPORTAMENTO",
    "VISIBILIDADE ALTA: PERFEITO PRA VER SEU DESTINO ERRADO DE LONGE",
    "CLIMA BOM: ATE A PREGUICA FICA MAIS LEVE",
    "DIA LIMPO: HOJE O UNIVERSO DECIDIU NAO TE SABOTAR"
  ],
  cloudy: [
    "TEMPO NUBLADO: O CEU TA PENSANDO EM ALGO SOMBRIO",
    "NUVENS DENSAS: O SOL TA FAZENDO HORA EXTRA ESCONDIDO",
    "CLIMA CINZA: FILTRO FEIO ATIVADO",
    "NUBLADO: O CEU FINGINDO QUE E INTROSPECTIVO",
    "NEBULOSO: PARECE QUE O CLIMA NAO DORMIU BEM"
  ]
};

const CITIES_LIST = [
  { name: "ORINDIUVA", lat: -20.1819, lon: -49.3508 },
  { name: "SAO JOSE DO RIO PRETO", lat: -20.8197, lon: -49.3797 },
  { name: "SAO PAULO", lat: -23.5505, lon: -46.6333 },
  { name: "RIO DE JANEIRO", lat: -22.9068, lon: -43.1729 },
  { name: "BRASILIA", lat: -15.7801, lon: -47.9292 },
  { name: "NOVA YORK", lat: 40.7128, lon: -74.0060 },
  { name: "LONDRES", lat: 51.5074, lon: -0.1278 },
  { name: "TOQUIO", lat: 35.6895, lon: 139.6917 }
];

// --- ARMAZENAMENTO GLOBAL ---
let GLOBAL_DATA = {
  weatherList: [],
  economy: null,
  history: null
};

// TEMA E REL√ìGIO
const themeBtn = document.getElementById('themeToggle');
const sun = document.getElementById('sunIcon');
const moon = document.getElementById('moonIcon');
let currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

function updateThemeUI(t){
  if(t === 'dark'){ document.body.classList.add('dark'); sun.style.display='block'; moon.style.display='none'; }
  else { document.body.classList.remove('dark'); sun.style.display='none'; moon.style.display='block'; }
}
updateThemeUI(currentTheme);
themeBtn.onclick = () => { currentTheme = currentTheme === 'dark' ? 'light' : 'dark'; updateThemeUI(currentTheme); localStorage.setItem('theme', currentTheme); };

function updateClock(){
  const n = new Date();
  document.getElementById('clockTime').textContent = n.toLocaleTimeString('pt-BR');
  document.getElementById('clockDate').textContent = n.toLocaleDateString('pt-BR', {weekday:'long', day:'numeric', month:'long'});
}
setInterval(updateClock, 1000); updateClock();

function getMoonPhase(date) {
  const diff = (date.getTime() - new Date('2000-01-06T18:14:00Z').getTime()) / 86400000;
  const idx = (diff % 29.5305882) / 29.5305882;
  if(idx < 0.03) return {icon:'üåë', t:'Nova'}; if(idx < 0.22) return {icon:'üåí', t:'Crescente'}; if(idx < 0.28) return {icon:'üåì', t:'Q. Cresc.'}; if(idx < 0.47) return {icon:'üåî', t:'Gibosa'};
  if(idx < 0.53) return {icon:'üåï', t:'Cheia'}; if(idx < 0.72) return {icon:'üåñ', t:'Gibosa'}; if(idx < 0.78) return {icon:'üåó', t:'Q. Ming.'}; if(idx < 0.97) return {icon:'üåò', t:'Minguante'};
  return {icon:'üåë', t:'Nova'};
}

function stripEmojis(str) {
  return str.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '').replace(/\s+/g, ' ').trim();
}

/* --- M√ìDULO DE DADOS --- */
async function fetchAllData() {
  try {
    // 1. Climas
    const lats = CITIES_LIST.map(c => c.lat).join(',');
    const lons = CITIES_LIST.map(c => c.lon).join(',');
    const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lats}&longitude=${lons}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,sunrise,sunset&timezone=America%2FSao_Paulo`);
    const wData = await wRes.json();
    GLOBAL_DATA.weatherList = Array.isArray(wData) ? wData : [wData];
    
    updateDashboard(GLOBAL_DATA.weatherList[0]);

    // 2. Economia
    const eRes = await fetch('https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,BTC-BRL');
    const eData = await eRes.json();
    GLOBAL_DATA.economy = [
      `DOLAR: R$ ${parseFloat(eData.USDBRL.bid).toFixed(2)}`,
      `EURO: R$ ${parseFloat(eData.EURBRL.bid).toFixed(2)}`,
      `BITCOIN: R$ ${(parseFloat(eData.BTCBRL.bid)/1000).toFixed(1)}K`
    ];

    // 3. Hist√≥ria
    const today = new Date();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const hRes = await fetch(`https://pt.wikipedia.org/api/rest_v1/feed/onthisday/selected/${mm}/${dd}`);
    const hData = await hRes.json();
    if(hData && hData.selected && hData.selected.length > 0) {
      const fact = hData.selected[Math.floor(Math.random() * hData.selected.length)];
      GLOBAL_DATA.history = `HOJE NA HISTORIA (${fact.year}): ${fact.text.toUpperCase()}`;
    }

  } catch(e) { console.error("Erro fetch", e); }
}

/* --- GERADOR DE LETREIRO (CICLO) --- */
function runTickerCycle() {
  const tickerEl = document.getElementById('newsTicker');
  
  let msgs = [];
  const now = new Date();
  const h = now.getHours();
  
  // 1. Sauda√ß√£o
  let greeting = "BOA NOITE";
  if (h >= 5 && h < 12) greeting = "BOM DIA";
  else if (h >= 12 && h < 18) greeting = "BOA TARDE";
  msgs.push(greeting);

  // 2. Frase Engra√ßada (Nova a cada ciclo)
  msgs.push(funnyPhrases[Math.floor(Math.random() * funnyPhrases.length)]);

  // 3. Data
  msgs.push(now.toLocaleDateString('pt-BR', {weekday:'long', day:'numeric', month:'long'}).toUpperCase());

  // 4. Economia (Se houver)
  if(GLOBAL_DATA.economy) msgs = msgs.concat(GLOBAL_DATA.economy);

  // 5. Clima Orindiuva + Frase
  if(GLOBAL_DATA.weatherList.length > 0) {
    const localW = GLOBAL_DATA.weatherList[0];
    msgs.push(`ORINDIUVA: ${Math.round(localW.current_weather.temperature)}C`);
    
    const code = localW.current_weather.weathercode;
    const t = localW.current_weather.temperature;
    let type = 'cloudy';
    if(code >= 95) type = 'storm'; else if(code >= 51) type = 'rain'; else if(t >= 30) type = 'heat'; else if(t <= 15) type = 'cold'; else if(code === 0) type = 'clear';
    msgs.push(weatherPhrases[type][Math.floor(Math.random() * weatherPhrases[type].length)]);
  }

  // 6. Outras Cidades
  if(GLOBAL_DATA.weatherList.length > 0) {
    GLOBAL_DATA.weatherList.forEach((w, i) => {
      if(i > 0) msgs.push(`${CITIES_LIST[i].name}: ${Math.round(w.current_weather.temperature)}C`);
    });
  }

  // 7. Hist√≥ria
  if(GLOBAL_DATA.history) msgs.push(stripEmojis(GLOBAL_DATA.history));

  msgs.push("CAMERA AO VIVO 24H");

  const fullText = msgs.map(m => stripEmojis(m)).join("  *** ");
  tickerEl.innerHTML = `<span class="ticker-item">${fullText}</span>`;

  // Anima√ß√£o
  tickerEl.style.animation = 'none';
  tickerEl.offsetHeight; 
  const duration = Math.max(30, fullText.length * 0.18);
  tickerEl.style.animation = `ticker-scroll ${duration}s linear infinite`;
}

// Configura loop do letreiro
document.getElementById('newsTicker').addEventListener('animationiteration', runTickerCycle);

function updateDashboard(data) {
  if(!data) return;
  const curr = data.current_weather;
  const daily = data.daily;
  const el = (id, txt) => { const e = document.getElementById(id); if(e) { e.textContent = txt; e.classList.remove('skeleton'); }};
  
  el('currTemp', Math.round(curr.temperature) + "¬∞C");
  el('windSpeed', Math.round(curr.windspeed) + " km/h");
  el('maxTemp', Math.round(daily.temperature_2m_max[0]) + "¬∞C");
  el('minTemp', Math.round(daily.temperature_2m_min[0]) + "¬∞C");
  
  let cond = "Nublado";
  const c = curr.weathercode;
  if(c === 0) cond = "C√©u Limpo"; else if([1,2,3].includes(c)) cond = "Parc. Nublado"; else if([45,48].includes(c)) cond = "Neblina"; else if([51,53,55,61,63,65,80,81,82].includes(c)) cond = "Chuva"; else if([95,96,99].includes(c)) cond = "Tempestade";
  el('currCond', cond);

  el('sunriseTime', daily.sunrise[0].split('T')[1]);
  el('sunsetTime', daily.sunset[0].split('T')[1]);
  
  const moon = getMoonPhase(new Date());
  el('moonPhase', moon.t);
  document.getElementById('moonLabel').textContent = moon.icon + " Lua";

  const box = document.getElementById('forecastBox');
  box.innerHTML = '';
  for(let i=1; i<=3; i++){
    const dName = new Date(daily.time[i]+'T00:00').toLocaleDateString('pt-BR',{weekday:'short'}).replace('.','');
    const ico = daily.weathercode[i] === 0 ? '‚òÄÔ∏è' : daily.weathercode[i] >= 51 ? 'üåßÔ∏è' : '‚õÖ';
    box.innerHTML += `<div class="forecast-item"><div class="f-day">${dName}</div><div class="f-icon">${ico}</div><div><span class="f-temp">${Math.round(daily.temperature_2m_max[i])}¬∞C</span> <span class="f-min">${Math.round(daily.temperature_2m_min[i])}¬∞C</span></div></div>`;
  }
}

const pb = document.getElementById('pixButton');
const pf = document.getElementById('pixFeedback');
pb.onclick = () => { navigator.clipboard.writeText(CHAVE_PIX).then(() => { pf.classList.add('show'); setTimeout(()=>pf.classList.remove('show'),2000); }).catch(()=>alert(CHAVE_PIX)); };

// Inicia sistema
fetchAllData().then(() => runTickerCycle()); // Dados primeiro, depois roda
setInterval(fetchAllData, 300000); // Atualiza dados a cada 5 min
</script>
</body>
</html>
